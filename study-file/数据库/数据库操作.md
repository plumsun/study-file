# 数据库操作

## 1.DQL



1.1 基本查询

```sql
--提单表数据查询
SELECT BILL_NO FROM CL_BIZ_BILL WHERE CONTAIN_CERT = '21C66_221000002';

--装箱表数据查询
SELECT * FROM CL_BIZ_APPLY WHERE CONTAIN_CERT = '21C66_221000002';

--查询
select * from CL_BIZ_CERT_SCHEDULE where CONTAIN_CERT = '14A31_220550028';

--查询
select OPER_PLACE_NAME,UPDATE_TIME from CL_COD_SHBES where PK_CLCODSHIPBUS ='80820';

--用户权限表
select * from DM_COD_DECLAU where EDI_ID = '60980261X';
```

1.2 复杂条件查询

```sql
select a.* from CL_BIZ_APPLY a WHERE  a.DELETE_FLAG = '1' and a.DE_CLARE_TYPE = 'W' and a.USER_NO = '60980261X-60980261X1' order by a.UPDATE_TIME desc;

--通过时间段查询证明书业务表中匹配的数据，并进行排序
SELECT a.* FROM CL_BIZ_APPLY a WHERE a.DELETE_FLAG = '1' AND a.COP_NO = '60980261X' AND TO_CHAR(a.CONTAIN_DATE,'yyyy-MM-dd HH24:mi:ss') BETWEEN '2022-07-07 00:00:00' AND '2022-11-11 00:00:00' ORDER BY a.UPDATE_TIME DESC;

---通过时间查询匹配申报表数据
SELECT * FROM GW_SHIP_INFO where TO_CHAR(GW_SHIP_INFO.CREATE_TIME,'yyyy-MM-dd HH24:mi:ss') BETWEEN '2023-02-10 09:00:00' AND '2023-02-10 15:00:00';

--通过时间查询匹配申报表数据的总数
SELECT COUNT(*) FROM GW_SHIP_INFO where TO_CHAR(GW_SHIP_INFO.CREATE_TIME,'yyyy-MM-dd HH24:mi:ss') BETWEEN '2023-02-10 09:00:00' AND '2023-02-10 15:00:00';

--通过时间查询匹配表头数据的总数，并进行
SELECT COUNT(*) FROM GW_RECEIPT_INFO where  TO_CHAR(GW_RECEIPT_INFO.CREATE_TIME,'yyyy-MM-dd HH24:mi:ss') BETWEEN '2023-02-10 09:00:00' AND '2023-02-10 15:00:00';

--通过时间查询匹配表头数据中MESSAGE_TYPE的总数
SELECT count(*) FROM GW_RECEIPT_INFO where MESSAGE_TYPE = 'SFCRST' AND  TO_CHAR(GW_RECEIPT_INFO.CREATE_TIME,'yyyy-MM-dd HH24:mi:ss') BETWEEN '2023-02-10 09:00:00' AND '2023-02-10 15:00:00';

--通过时间查询匹配表体数据中MESSAGE_TYPE的总数
SELECT COUNT(*) FROM GW_MESSAGE_HEAD where MESSAGE_TYPE = 'SFCRST' AND  TO_CHAR(GW_MESSAGE_HEAD.CREATE_TIME,'yyyy-MM-dd HH24:mi:ss') BETWEEN '2023-02-10 09:00:00' AND '2023-02-10 15:00:00';

--通过reply_id排序查询表体数据
SELECT * FROM GW_MESSAGE_HEAD ORDER BY REPLY_ID DESC;
```

1.3 分页查询

```sql
--oracle分页查询sql
select * from (select row_.*,rownum rownum_ from (select a.* from CL_BIZ_APPLY a where a.DELETE_FLAG = '1' and a.DE_CLARE_TYPE = 'W' and a.USER_NO = '60980261X-60980261X1' order by a.UPDATE_TIME desc ) row_ where rownum <= 20) where rownum_ > 10;


SELECT * FROM (SELECT a.* FROM CL_BIZ_APPLY a WHERE a.DELETE_FLAG = '1' AND a.COP_NO = '60980261X' AND TO_CHAR(a.CONTAIN_DATE,'yyyy-MM-dd HH24:mi:ss') BETWEEN '2022-07-07 00:00:00' AND '2022-11-11 00:00:00' ORDER BY a.UPDATE_TIME DESC ) WHERE rownum <= ?;
```

1.4 连接查询

```sql
--左连接查询总数
SELECT COUNT(*) FROM CL_BIZ_APPLY a LEFT JOIN CL_BIZ_BILL b ON a.CONTAIN_CERT = b.CONTAIN_CERT;

--左连接条件查询，并对数据进行去重和排序
SELECT DISTINCT a.CONTAIN_CERT ,a.PK_CLBIZAPPLY ,a.SHIP_NAME_CN ,a.VOYAGE ,a.DE_CLARE_TYPE ,a.STATUS ,a.INSPECTOR_CERT ,a.INSPECTOR_NAME ,a.CONTAIN_TYPE ,a.CONTAIN_DATE ,a.UPDATE_TIME FROM CL_BIZ_APPLY a LEFT JOIN CL_BIZ_BILL b ON a.CONTAIN_CERT = b.CONTAIN_CERT WHERE a.DELETE_FLAG = '1' AND a.DE_CLARE_TYPE = 'W' AND a.USER_NO = '60980261X-60980261X1' ORDER BY a.UPDATE_TIME DESC;

--左连接条件查询，并对数据进行去重和排序
SELECT DISTINCT * FROM CL_BIZ_APPLY a LEFT JOIN CL_BIZ_BILL b ON a.CONTAIN_CERT = b.CONTAIN_CERT WHERE a.DE_CLARE_TYPE = 'W' AND a.DELETE_FLAG = '1' ORDER BY a.UPDATE_TIME DESC;
```





## 2.DML

2.1 插入

```sql
--数据插入
INSERT INTO DM_COD_DECLAU ("PK_DMCODDECLAU", "EDI_ID", "CLIENT_FUNCTION", "UPDATE_TIME", "CREATE_TIME", "NO_OWN_SYS", "NO_OWN_MENU", "REG_NO", "ORG_NAME") VALUES ('803', '60980261X', '00001100000', TO_DATE('2022-09-13 17:12:38', 'SYYYY-MM-DD HH24:MI:SS'), TO_DATE('2022-09-13 17:12:38', 'SYYYY-MM-DD HH24:MI:SS'), NULL, NULL, '21C66', '浙江衢化氟化学有限公司');
INSERT INTO DM_COD_DECLAU ("PK_DMCODDECLAU", "EDI_ID", "CLIENT_FUNCTION", "UPDATE_TIME", "CREATE_TIME", "NO_OWN_SYS", "NO_OWN_MENU", "REG_NO", "ORG_NAME") VALUES ('804', '60980261X', '00001100000', TO_DATE('2022-09-13 17:12:38', 'SYYYY-MM-DD HH24:MI:SS'), TO_DATE('2022-09-13 17:12:38', 'SYYYY-MM-DD HH24:MI:SS'), NULL, NULL, '21D72', '浙江衢化氟化学有限公司');
```

2.2 更新

```sql
--根据条件修改数据
UPDATE CL_BIZ_APPLY set STATUS='0' WHERE CONTAIN_CERT = '14A31_220550028';

--根据时间修改数据
UPDATE MSDAT_SHIP_CONFIRM t SET t.OLD_DATA = '3' WHERE t.DECLARE_TIME >= TO_DATE('2022-11-10 00:00:00', 'yyyy-MM-dd HH24:MI:SS') AND t.DECLARE_TIME <= TO_DATE('2022-11-10 23:59:59', 'yyyy-MM-dd HH24:MI:SS') AND t.CHECK_STATUS = '2' AND t.IN_OUT_MARK != '0' AND t.OLD_DATA IS NULL;


--修改 非进口数据--1
update T_SHIP_CONFIRM t set t.OLD_DATA = '3' WHERE t.DECLARE_TIME >= TO_DATE('2022-11-10 00:00:00','yyyy-MM-dd HH24:MI:SS') AND t.DECLARE_TIME <= TO_DATE('2022-11-10 23:59:59', 'yyyy-MM-dd HH24:MI:SS') AND t.CHECK_STATUS = '2'  AND t.IN_OUT_MARK !='0' AND t.OLD_DATA is null;

--修改 进口数据--2
update T_SHIP_CONFIRM set t.OLD_DATA = null where t.OLD_DATA = '3' AND t.DECLARE_TIME >= TO_DATE('2022-11-10 00:00:00','yyyy-MM-dd HH24:MI:SS') AND t.DECLARE_TIME <= TO_DATE('2022-11-10 23:59:59', 'yyyy-MM-dd HH24:MI:SS');


update T_SHIP_CONFIRM t set t.OLD_DATA = '3' WHERE t.DECLARE_TIME >= TO_DATE('2022-11-10 00:00:00','yyyy-MM-dd HH24:MI:SS') AND t.DECLARE_TIME <= TO_DATE('2022-11-10 23:59:59', 'yyyy-MM-dd HH24:MI:SS') AND t.CHECK_STATUS = '2'  AND t.IN_OUT_MARK = '0' AND t.OLD_DATA is null;


--修改 进口数据--3
update T_SHIP_CONFIRM t set t.OLD_DATA = null where t.OLD_DATA = '3' AND t.DECLARE_TIME >= TO_DATE('2022-11-10 00:00:00','yyyy-MM-dd HH24:MI:SS') AND t.DECLARE_TIME <= TO_DATE('2022-11-10 23:59:59', 'yyyy-MM-dd HH24:MI:SS');
```



## 3.DDL

3.1 truncate

```sql
--清空数据表，保存表结构
TRUNCATE TABLE GW_SHIP_INFO;
```



## 4.DCL

### 5.数据库函数

5.1 时间函数

```sql
--oracle进行时间段匹配方法
TO_CHAR(a.CONTAIN_DATE,'yyyy-MM-dd HH24:mi:ss') BETWEEN '2022-07-07 00:00:00' AND '2022-11-11 00:00:00'
a.CONTAIN_DATE BETWEEN TO_DATE('2022-07-07 00:00:00', 'yyyy-MM-dd HH24:MI:SS') AND TO_DATE('2022-11-11 00:00:00', 'yyyy-MM-dd HH24:MI:SS')
```



